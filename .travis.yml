#we use java
language: java

#we add the java development kit (jdk)
jdk:
- oraclejdk14
# SonarCloud
addons:
  sonarcloud:
    organization: "nielshendrickx"
    token:
      secure: "WYRpB/eFYyXtQRc+zvHuNtaAnM2k5I0pW5VBqwB84q+ksnWYXtvTHn2Ek4drASbxGMuQDN2D+4aACyrX06T/66oSnoUZzT+vDp42471kBgREYudCw9JRmUc6uwquvqPvNaoLlTAp3Lgdt1/kbb0/yvw0UsBzl8bByjYrLZs2VI4c7VUOOT+mU/RprCX7ZnSmdWEjXsgHp8yDvFisC9SS6UKOAfU2diTWMq0jbu0UZVSEUx/XMxsbq4KX4QXUR/tx7h9r6jBb4D83WQSf6DPv7xYLV+tKr6dbqbyhP9zoIQpTY2eIMevKTx7vujYcgG+nAYVGfhAI+V3Ud7/Cg2szlZj+CuD/43fQnUgVB0wpCbHvcw7C1HEY2SOwncQTrbennr1vy7ZkgQwaa9EoBhBPpA/eqYfZhMxwpcxCAAJp8+L32nyGi89KDeVM0+HnKvYbK94iyvEyUoElOCtmYxd1+4XtwYOsT9hDNUZH5ybxrlLyRs9xP2IMx4Ej/i2iBFgs1ymcCWU+Z72ennNS11ZU5KnnSrfccpe4DTTGJ1JKjq3KxoIdt3F60H/nXsBI1f8fNkZ4Kl+kxyU7GYF9okgJjG37e5iCIRQr5w5rivrbJXsj/UZU8DFsPI5qpCbA8Jy+oLpU5/ApEoDGJBQB/vXRKODYl86UtzDHcyLF7frw6sk=" # encrypted value of your token

before_install:
- mvn clean

script:
#We avoid this error :" the job exceeded the maximum log length and has been terminated "
- echo -e '<?xml version="1.0" encoding="UTF-8"?>\n<settings xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.1.0 http://maven.apache.org/xsd/settings-1.1.0.xsd" xmlns="http://maven.apache.org/SETTINGS/1.1.0"\n    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n  <mirrors>\n    <mirror>\n      <id>mvnsearch-unavailable</id>\n      <name>mvnsearch-unavailable</name>\n      <mirrorOf>mvnsearch</mirrorOf>\n      <url>http://repo1.maven.org/maven2</url>\n    </mirror>\n  </mirrors>\n  <profiles>\n    <profile>\n      <id>no-mvnsearch</id>\n      <repositories>\n        <repository>\n          <id>mvnsearch</id>\n          <url>http://www.mvnsearch.org/maven2</url>\n          <releases>\n            <enabled>true</enabled>\n          </releases>\n          <snapshots>\n            <enabled>true</enabled>\n          </snapshots>\n        </repository>\n      </repositories>\n    </profile>\n  </profiles>\n  <activeProfiles>\n    <activeProfile>no-mvnsearch</activeProfile>\n  </activeProfiles>\n</settings>' > $HOME/.m2/settings.xml
- cat $HOME/.m2/settings.xml
#deploying the app on Heroku
- cd jar
- mvn heroku:deploy
after_success:
#codecoverage
- bash <(curl -s https://codecov.io/bash)
# SonarCloud
# the following command line builds the project, runs the tests with coverage and then execute the SonarCloud analysis
- mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.projectKey=nielshendrickx_switchfully-DigiBooky
